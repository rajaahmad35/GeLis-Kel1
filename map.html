<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GeLIS - Map</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to bottom, #f3f4f6, #e5e7eb);
            color: #1f2937;
        }
        .fade-in {
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .fade-in.visible {
            opacity: 1;
            transform: translateY(0);
        }
        nav {
            background: linear-gradient(to right, #ffffff, #f8fafc);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        nav a {
            transition: color 0.3s ease, transform 0.2s ease;
        }
        nav a:hover {
            color: #4b6cb7;
            transform: translateY(-2px);
        }
        footer {
            background: linear-gradient(to right, #1e3a8a, #4b6cb7);
        }
        #map {
            height: 600px;
            width: 100%;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .sidebar {
            position: absolute;
            top: 20px;
            left: 20px;
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            width: 300px;
            transition: transform 0.3s ease;
        }
        .sidebar:hover {
            transform: translateY(-3px);
        }
        .sidebar input {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            transition: border-color 0.3s ease;
        }
        .sidebar input:focus {
            border-color: #4b6cb7;
            outline: none;
        }
        .control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(145deg, #ffffff, #f1f5f9);
            padding: 1rem;
            border-radius: 10px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transition: transform 0.3s ease;
        }
        .control-panel:hover {
            transform: translateY(-3px);
        }
        .search-result {
            margin-top: 12px;
            color: #1e3a8a;
            font-weight: 500;
        }
        .highlight-marker {
            background: linear-gradient(45deg, #fefcbf, #facc15);
            border: 3px solid #dc2626;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            text-align: center;
            line-height: 24px;
            color: #1e3a8a;
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="bg-gray-100">
    <nav class="bg-white shadow-lg fixed w-full z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-indigo-600">GeLIS</span>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="home.html" class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Home</a>
                    <a href="about.html" class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">About</a>
                    <a href="map.html" class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Map</a>
                    <a href="land-data.html" class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Land Data</a>
                    <a href="admin.html" class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium" id="admin-link">Admin</a>
                    <a href="contact.html" class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Contact</a>
                    <button onclick="logout()" class="text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md text-sm font-medium">Logout</button>
                </div>
            </div>
        </div>
    </nav>
    <section id="map-section" class="py-20 bg-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-bold text-center text-gray-800 mb-8 fade-in">Interactive Map</h2>
            <div id="map-container" class="fade-in">
                <div id="map"></div>
                <div class="sidebar">
                    <input type="text" id="search" placeholder="Cari NIB...">
                    <button onclick="searchLocation()" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700">Cari</button>
                    <div id="search-result" class="search-result"></div>
                </div>
                <div class="control-panel"></div>
            </div>
        </div>
    </section>
    <footer class="bg-gray-800 text-white py-6">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <p>© 2025 GeLIS. All rights reserved.</p>
        </div>
    </footer>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const userRole = localStorage.getItem('userRole') || '';
        document.getElementById('admin-link').style.display = userRole === 'admin' ? 'block' : 'none';
        window.landData = [
            { id: 1, nib: "12345", harga: "Rp 500 jt", status: "Tersedia", pemilik: "Budi", luas: "200 m²", penggunaan: "Pertanian", desa: "Sungai", lat: -7.2918517, lng: 110.7510066 },
            { id: 2, nib: "67890", harga: "Rp 1 M", status: "Dijual", pemilik: "Ani", luas: "500 m²", penggunaan: "Perumahan", desa: "Jaringan", lat: -7.2908517, lng: 110.7520066 },
            { id: 3, nib: "11122", harga: "Rp 750 jt", status: "Tersedia", pemilik: "Cahyo", luas: "300 m²", penggunaan: "Komersial", desa: "Bunga", lat: -7.2928517, lng: 110.7500066 },
            { id: 4, nib: "22233", harga: "Rp 1.2 M", status: "Dijual", pemilik: "Dina", luas: "600 m²", penggunaan: "Industri", desa: "Pinang", lat: -7.2913517, lng: 110.7515066 },
            { id: 5, nib: "33344", harga: "Rp 400 jt", status: "Tersedia", pemilik: "Eko", luas: "150 m²", penggunaan: "Pertanian", desa: "Cemara", lat: -7.2923517, lng: 110.7505066 },
            { id: 6, nib: "44455", harga: "Rp 800 jt", status: "Dijual", pemilik: "Fani", luas: "400 m²", penggunaan: "Perumahan", desa: "Melati", lat: -7.2903517, lng: 110.7515066 },
            { id: 7, nib: "55566", harga: "Rp 1.5 M", status: "Tersedia", pemilik: "Gita", luas: "700 m²", penggunaan: "Komersial", desa: "Teratai", lat: -7.2918517, lng: 110.7495066 },
            { id: 8, nib: "66677", harga: "Rp 300 jt", status: "Dijual", pemilik: "Hadi", luas: "100 m²", penggunaan: "Pertanian", desa: "Mawar", lat: -7.2933517, lng: 110.7515066 },
            { id: 9, nib: "77788", harga: "Rp 900 jt", status: "Tersedia", pemilik: "Indah", luas: "450 m²", penggunaan: "Industri", desa: "Anggrek", lat: -7.2908517, lng: 110.7505066 },
            { id: 10, nib: "88899", harga: "Rp 1.1 M", status: "Dijual", pemilik: "Joko", luas: "550 m²", penggunaan: "Perumahan", desa: "Kamboja", lat: -7.2923517, lng: 110.7525066 },
            { id: 11, nib: "99900", harga: "Rp 600 jt", status: "Tersedia", pemilik: "Kiki", luas: "250 m²", penggunaan: "Komersial", desa: "Flamboyan", lat: -7.2913517, lng: 110.7490066 },
            { id: 12, nib: "10111", harga: "Rp 700 jt", status: "Dijual", pemilik: "Lina", luas: "350 m²", penggunaan: "Pertanian", desa: "Sakura", lat: -7.2938517, lng: 110.7510066 },
            { id: 13, nib: "11222", harga: "Rp 1.3 M", status: "Tersedia", pemilik: "Mira", luas: "650 m²", penggunaan: "Industri", desa: "Bougenville", lat: -7.2903517, lng: 110.7495066 },
            { id: 14, nib: "12333", harga: "Rp 450 jt", status: "Dijual", pemilik: "Nanda", luas: "200 m²", penggunaan: "Perumahan", desa: "Jasmine", lat: -7.2928517, lng: 110.7520066 },
            { id: 15, nib: "13444", harga: "Rp 850 jt", status: "Tersedia", pemilik: "Oki", luas: "400 m²", penggunaan: "Komersial", desa: "Lotus", lat: -7.2918517, lng: 110.7500066 },
            { id: 16, nib: "14555", harga: "Rp 1.4 M", status: "Dijual", pemilik: "Puji", luas: "600 m²", penggunaan: "Industri", desa: "Orchid", lat: -7.2908517, lng: 110.7515066 },
            { id: 17, nib: "15666", harga: "Rp 350 jt", status: "Tersedia", pemilik: "Rina", luas: "150 m²", penggunaan: "Pertanian", desa: "Rose", lat: -7.2923517, lng: 110.7495066 },
            { id: 18, nib: "16777", harga: "Rp 950 jt", status: "Dijual", pemilik: "Sari", luas: "500 m²", penggunaan: "Perumahan", desa: "Lily", lat: -7.2913517, lng: 110.7525066 },
            { id: 19, nib: "17888", harga: "Rp 1.6 M", status: "Tersedia", pemilik: "Tono", luas: "700 m²", penggunaan: "Komersial", desa: "Dahlia", lat: -7.2938517, lng: 110.7505066 },
            { id: 20, nib: "18999", harga: "Rp 550 jt", status: "Dijual", pemilik: "Umi", luas: "300 m²", penggunaan: "Industri", desa: "Tulip", lat: -7.2903517, lng: 110.7510066 }
        ];
        function initializeMap() {
            if (!document.getElementById('map')) {
                console.error('Map container not found');
                return;
            }
            window.map = L.map('map').setView([-7.2918517, 110.7510066], 15);
            const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(window.map);
            const layers = {
                'Bidang Tanah': L.tileLayer.wms("http://localhost:8080/geoserver/wms", {
                    layers: "Bidang Tanah",
                    format: "image/png",
                    transparent: true,
                    attribution: "GeoServer WMS"
                }),
                'WMS Admin Genengsari': L.tileLayer.wms("http://localhost:8080/geoserver/wms", {
                    layers: "admin_genengsari",
                    format: "image/png",
                    transparent: true,
                    attribution: "GeoServer WMS"
                }),
                'WMS Jaringan Jalan': L.tileLayer.wms("http://localhost:8080/geoserver/wms", {
                    layers: "Jaringan Jalan",
                    format: "image/png",
                    transparent: true,
                    attribution: "GeoServer WMS"
                }),
                'WMS Sungai': L.tileLayer.wms("http://localhost:8080/geoserver/wms", {
                    layers: "Sungai",
                    format: "image/png",
                    transparent: true,
                    attribution: "GeoServer WMS"
                }),
                'WMS Harga Tanah': L.tileLayer.wms("http://localhost:8080/geoserver/wms", {
                    layers: "Harga Tanah",
                    format: "image/png",
                    transparent: true,
                    attribution: "GeoServer WMS"
                })
            };
            window.landData.forEach(data => {
                L.marker([data.lat, data.lng]).addTo(window.map)
                    .bindPopup(`NIB: ${data.nib}<br>Harga: ${data.harga}<br>Status: ${data.status}`)
                    .on('click', () => highlightLand(data.nib));
            });
            const baseLayers = { "OpenStreetMap": osm };
            const overlays = {
                "Bidang Tanah": layers['Bidang Tanah'],
                "Harga Tanah": layers['WMS Harga Tanah'],
                "Admin Genengsari": layers['WMS Admin Genengsari'],
                "Jaringan Jalan": layers['WMS Jaringan Jalan'],
                "Sungai": layers['WMS Sungai']
            };
            L.control.layers(baseLayers, overlays, { position: 'topright' }).addTo(window.map);
            L.control.scale().addTo(window.map);
            L.marker([-7.2918517, 110.7510066]).addTo(window.map)
                .bindPopup('Genengsari<br>Lat: -7.2918517, Long: 110.7510066')
                .openPopup();
        }
        function searchLocation() {
            const query = document.getElementById('search')?.value.trim();
            const resultDiv = document.getElementById('search-result');
            if (!query || !resultDiv) return;
            const matchedData = window.landData.find(data => data.nib === query);
            if (matchedData) {
                resultDiv.innerHTML = `Ditemukan: NIB ${matchedData.nib}, Pemilik: ${matchedData.pemilik}, Harga: ${matchedData.harga}`;
                window.map.setView([matchedData.lat, matchedData.lng], 15);
                highlightLand(matchedData.nib);
            } else {
                resultDiv.innerHTML = 'NIB tidak ditemukan.';
            }
        }
        function highlightLand(nib) {
            const matchedData = window.landData.find(data => data.nib === nib);
            if (matchedData && window.map) {
                if (window.map.highlightedMarker) {
                    window.map.removeLayer(window.map.highlightedMarker);
                }
                window.map.highlightedMarker = L.marker([matchedData.lat, matchedData.lng], {
                    icon: L.divIcon({ className: 'highlight-marker', html: '▲' })
                }).addTo(window.map)
                    .bindPopup(`NIB: ${matchedData.nib}<br>Harga: ${matchedData.harga}<br>Status: ${matchedData.status}`)
                    .openPopup();
            }
        }
        function logout() {
            localStorage.removeItem('userRole');
            window.location.href = 'login.html';
        }
        initializeMap();
        const fadeIns = document.querySelectorAll('.fade-in');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, { threshold: 0.1 });
        fadeIns.forEach(element => observer.observe(element));
    </script>
</body>
</html>